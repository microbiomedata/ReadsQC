# Validation Workflow

## Summary 

The ReadsQC validation workflow is meant to compare test data in json format available on the NMDC github against data generated by user test input. The purpose is to ensure user test data matches to or falls within an acceptable range of the NMDC test data in an effort to push towards reproducible data standards. The **rqc_test.wdl** file contains most of the neccesary inputs needed for the ReadsQC worfklow and will grab user generated json file, but will require user input for the path of the database in their local environment and local user paths for test data to be updated in the input.json. 


## Input files for rqc_test.wdl
1. ReadsQC workflow contianer(provided),  
2. Comparejson container(provided), 
3. database (path to database provided by user),
4. memory (optional, can be changed by user),
5. threads (optional, can be changed by user),
6. url for test fasta (provided),
7. url for NMDC test json (provided for small test data)
```
workflow rqctest {
  String  container="microbiomedata/bbtools:38.94"
  String  validate_container="microbiomedata/comparejson"
  String  database="/vol_b/nmdc_workflows/data/test_refdata"
  Boolean flag=false
  String? memory="60G"
  String? threads="8"
  String  url="https://portal.nersc.gov/cfs/m3408/test_data/Ecoli_10x-int.fastq.gz"
  String  ref_json="https://raw.githubusercontent.com/microbiomedata/ReadsQC/master/test/small_test_filterStats.json"
```
## Docker contianers can be found here:
Bbtools: [microbiomedata/bbtools:38.44](https://hub.docker.com/r/microbiomedata/bbtools)
Comparjson: [microbiomedata/comparejson](https://hub.docker.com/r/microbiomedata/comparejson)

## Running Testing Validation Workflow

The command for running test validation is similar to that found in the submit.sh file, with the exception of switching out rqcfilter.wdl for rqc_test.wdl.

 - `rqc_test.wdl` file: the WDL file for workflow definition
 - `input.json` file: the test input for the workflow
 - `cromwell.conf` file: the conf file for running Cromwell.
 -  `cromwell.jar` file: the jar file for running Cromwell.
 -  `metadata_out.json` file: file collects run data, will be created after run of command
 
Example:
```
java -Dconfig.file=cromwell.conf -jar cromwell.jar run -m metadata_out.json -i input.json rqc_test.wdl
```

## Validation Metric
Validation metric is determined through a printed command line statement that will read:
```
"test.validate.result": ["No differences detected: test validated"]
```
or 
```
"test.validate.result": ["Test Failed"]
```

If test fails, please check inputs or contact local system administrators to ensure there are no system issues causing discrepency in results. 
